# 📊 レバレッジETF シミュレーター

対数正規分布モデルを使用して、レバレッジETFの長期投資におけるリターン分布とリスクを可視化するインタラクティブシミュレーターです。

**💡 初期値はSOXL（半導体3倍レバレッジETF）に合わせて設定**
- ドリフト：14%（半導体セクターの期待リターン）
- ボラティリティ：34%（高変動セクター）
- 金利：3%（現在の金利水準）
- 経費：0.95%（SOXLの実際の経費率）

## 🎯 プロジェクトの目的

レバレッジETFの投資判断をサポートするため、以下の重要な統計指標を可視化します：

- **対数正規分布による資産分布**の視覚化
- **投資期間の影響**を直感的に理解
- **期待値、中央値、最頻値**の比較
- **統計的優位性ゾーン**の判定
- **ボラティリティ減価**の影響評価

## ✨ 実装済み機能

### 📈 グラフ機能

1. **資産分布の比較グラフ**
   - 通常ETF (L=1) とレバレッジETF (L=任意) の分布を比較
   - 期待値、中央値、最頻値を縦線で表示
   - 投資期間に応じた分布の変化を可視化
   - リアルタイムで比率計算（期待値比、中央値比、最頻値比）

2. **統計的優位ゾーングラフ**
   - レバレッジ倍率に応じた優位性を色分け表示
   - 緑ゾーン：レバレッジETFが有利
   - 赤ゾーン：通常ETFが有利
   - 中央値優位上限と最頻値優位上限を表示

3. **モンテカルロシミュレーション時系列グラフ（NEW! - 日次計算版）**
   - **初期投資額100万円**からシミュレーション開始
   - **日次ベースの詳細シミュレーション**：年間252営業日（米国市場基準）で計算
   - **試行回数を10〜500回まで調整可能**（スライダーで変更、10刻み）
     - 回数が多いほど理論値との一致度が向上
     - 自動透明度調整で多数の軌跡も見やすく表示
     - 適度な範囲で動作が軽快
   - 通常ETF (L=1) とレバレッジETF (L=任意) の時系列推移を可視化
   - **対数/線形スケール切替機能**：ボタンで表示方法を変更可能
     - 線形スケール：Y軸最大値をスライダーで調整可能（100〜5,000万円）
     - データの範囲に応じて最適な表示幅を設定可能
   - 理論期待値（破線）、理論中央値（実線）、理論最頻値（点線）を重ねて表示
   - シミュレーション結果の統計量を**万円単位**で表示（平均、中央値、最大、最小）
   - 理論値との比較で精度を確認可能
   - 日々の変動とボラティリティ減価をリアルに再現
   - 幾何ブラウン運動に基づく正確な確率モデル

4. **モンテカルロ最終資産分布グラフ（NEW!）**
   - シミュレーション結果の最終資産倍率（元本=1）をヒストグラムで表示
   - 理論分布曲線（対数正規分布）を重ねて表示
   - グラフ1と同じ軸スケール（倍率表示）で比較しやすく
   - 実測値と理論値の一致度を視覚的に確認
   - 理論期待値・中央値を縦線で表示
   - 確率密度で正規化（面積が1になるよう調整）
   - ビン数は試行回数に応じて自動調整（Sturgesの公式）
   - 試行回数を増やすほど理論曲線に近づく様子を確認可能

### ⚙️ パラメータ調整機能

すべてのパラメータをスライダーで動的に調整可能：

- **投資期間 (T)**: 1〜20年
- **レバレッジ (L)**: 1.0〜5.0倍
- **ドリフト (μ)**: 0〜0.30（年間期待リターン率）
- **ボラティリティ (σ)**: 0.01〜0.50（年間変動率）
- **金利 (b)**: 0〜0.10（レバレッジコスト）
- **経費 (c)**: 0〜0.10（年間運用経費率）
- **シミュレーション回数**: 10〜500回（モンテカルロ試行回数、10刻み）
- **線形スケールY軸最大値**: 100〜5,000万円（グラフ3の線形表示時の上限）

### 📊 統計カード表示

- **投資期間**: 現在選択されている期間を表示
- **リスクプレミアム**: μ - b の計算値
- **中央値優位上限**: 中央値でレバレッジETFが有利となる最大倍率
- **最頻値優位上限**: 最頻値でレバレッジETFが有利となる最大倍率

### 💡 ユーザー支援機能

- **リアルタイム更新**: パラメータ変更時に即座にグラフ更新
- **情報ボックス**: 投資期間の影響について解説
- **警告ボックス**: 長期投資のリスクについて注意喚起
- **レスポンシブデザイン**: モバイル端末でも快適に操作可能

## 🔧 使用技術

- **HTML5**: セマンティックな構造設計
- **CSS3**: グラデーション、アニメーション、レスポンシブレイアウト
- **JavaScript (ES6+)**: 数学的計算とインタラクティブ機能
- **Plotly.js 2.26.0**: 高度なデータ可視化

## 📐 数学的モデル

### 対数正規分布のパラメータ

T年後の資産倍率 X_T は以下の対数正規分布に従います：

```
α = T × (L×μ - (L-1)×b - c - 0.5×L²×σ²)
β = √T × L × σ
```

### 統計量の計算式

- **期待値 (Mean)**: E[X_T] = exp(α + β²/2)
- **中央値 (Median)**: M[X_T] = exp(α)
- **最頻値 (Mode)**: Mode[X_T] = exp(α - β²)

### 優位性の判定条件

- **中央値優位上限**: L ≤ (2×(μ-b)/σ²) - 1
- **最頻値優位上限**: L ≤ (2×(μ-b)/(3×σ²)) - 1

## 🚀 機能エントリポイント

| 機能 | ファイル | 説明 |
|------|---------|------|
| メインページ | `index.html` | シミュレーターのメインインターフェース |

## 📝 今後の推奨開発項目

### ✅ 最近追加・修正された機能

- **数式表示**: ヘッダーにレバレッジETFの複利込み平均年利の原則を明示
  - ①増価、②減価、③金利、④経費の4要素を視覚化
  
- **日次リバランスモデルに修正（重要）**: より正確なシミュレーション
  - **原指数の日次リターンをL倍する**正しいモデルに変更
  - 毎日コストを指数関数的に控除
  - 実際のレバレッジETFの運用方法を正確に再現
  - ゼロ割れ防止機能を追加（価格が負にならない）
  
- **日次モンテカルロシミュレーション**: 年間252営業日ベースで投資期間全体にわたる資産推移をシミュレーション
  - より現実的な日々の変動を再現（米国市場の実際の営業日数に基づく）
  - レバレッジETFの日次リバランスの影響を正確に反映
  - ボラティリティ減価の累積効果を可視化
  - 対数/線形スケール切替でリスクを多角的に視覚化
  - 理論最頻値を追加表示（最も起こりやすい結果）
  - 試行回数10〜500回で動作が軽快

### 高優先度

1. **データエクスポート機能**
   - グラフ画像のダウンロード（PNG, SVG）
   - パラメータ設定のJSON保存/読込
   - 計算結果のCSVエクスポート

2. **プリセット機能**
   - 代表的なETF（S&P500、NASDAQ100など）のパラメータプリセット
   - ユーザー設定の保存（localStorage活用）

3. **比較モード**
   - 複数のレバレッジ倍率を同時に比較
   - 異なる投資期間の並列表示

### 中優先度

4. **シミュレーション機能**
   - モンテカルロシミュレーション
   - 確率分布からのランダムサンプリング表示
   - パーセンタイル表示（10%, 25%, 75%, 90%など）

5. **教育コンテンツ**
   - 計算式の詳細説明ページ
   - インタラクティブチュートリアル
   - よくある質問（FAQ）セクション

6. **詳細分析機能**
   - 損失確率の計算（元本割れ確率など）
   - シャープレシオの計算
   - 最大ドローダウンの推定

### 低優先度

7. **デザイン強化**
   - ダークモード対応
   - カラースキームのカスタマイズ
   - アニメーション効果の追加

8. **パフォーマンス最適化**
   - Web Worker による計算の並列処理
   - グラフの描画パフォーマンス改善

9. **多言語対応**
   - 英語版の追加
   - 言語切り替え機能

## 🔧 重要な修正履歴

### v1.1.0 - 日次リバランスモデルへの修正

**問題点：**
以前のバージョンでは、レバレッジETFを独立したGBM（幾何ブラウン運動）としてモデル化していました。これは理論的には正しい最終分布を与えますが、日々の価格変動（パス）が実際のレバレッジETFとは異なっていました。

**修正内容：**
モンテカルロシミュレーション（グラフ3、4）を**日次リバランスモデル**に変更：

```javascript
// 修正前（誤り）：レバレッジETF自体を独立したGBMとしてモデル化
// ボラティリティドラッグ項を日々のドリフトに含めていた（理論的に不正確）

// 修正後（正しい）：原指数の日次リターンをL倍する日次リバランス
indexReturn = (μ - 0.5σ²)dt + σ√dt * Z
leveragedReturn = L * indexReturn
価格 = 前日価格 * exp(leveragedReturn) * exp(-(L-1)b*dt - c*dt)
```

**影響：**
- シミュレーション結果が実際のレバレッジETFの挙動により近くなりました
- 理論値（グラフ1の分布曲線）との一致度が向上
- パス依存性（経路依存性）を正しく反映

---

## ⚠️ 注意事項

### 免責事項

このシミュレーターは教育・情報提供を目的としており、投資助言ではありません：

- **モデルの限界**: 実際の市場は対数正規分布に完全には従いません
- **コストの簡略化**: リバランスコストや税金は考慮されていません
- **過去の実績**: 過去のパラメータが将来も継続する保証はありません
- **投資判断**: 必ずご自身で調査・判断の上、投資を行ってください

### 技術的制約

- **静的サイト**: サーバーサイド処理は行いません
- **クライアント計算**: すべての計算はブラウザ上で実行されます
- **データ永続化**: 現在、設定の自動保存機能はありません（今後実装予定）

## 📄 ライセンス

このプロジェクトは教育目的で作成されています。

## 🤝 貢献

改善提案やバグ報告を歓迎します！

---

**最終更新**: 2025年10月  
**バージョン**: 1.0.0  
**作成者**: レバレッジETFシミュレータープロジェクトチーム
